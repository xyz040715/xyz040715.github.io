$(document).ready(function(){function getParameterByName(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function showSpinner(custom){null==__spinner&&(__spinner=(new Spinner).spin()),$(".ol__entry").length>0?($(".ol__entry").append(__spinner.el),$(".ol__entry").addClass("blocker")):$(".entry").length>0?($(".entry").append(__spinner.el),$(".entry").addClass("blocker")):$(custom).length>0&&($(custom).append(__spinner.el),$(custom).addClass("blocker")),$("#ol-zip,#ol-search-btn ,.ol-location-btn").prop("disabled",!0)}function removeSpinner(){$("body .spinner").remove(),$("body").removeClass("blocker"),$(".ol__entry .spinner, .entry .spinner").remove(),$(".ol__entry, .entry").removeClass("blocker"),$("#ol-zip,#ol-search-btn ,.ol-location-btn").prop("disabled",!1)}function _switchToApp(){$(".ol-office-not-found-msg").addClass("hide"),$("section#ol-tool").css("display","block"),removeSpinner(),"undefined"!=typeof switchToApp&&switchToApp(),$(".ol__entry, .entry, .tools__close, #ol-close").addClass("hide"),$(".ol__entry-screen, .ol__entry-screen__restart, .ol__entry-screen h2").removeClass("hide"),closeEventHandler(),backToSearchEventHandler()}function _switchToEntry(obj){removeSpinner(),obj&&0==obj.officeAvailable?($(".ol-office-not-found-msg").removeClass("hide"),$(".ol_use_current_location").css("bottom","-70px")):($(".ol-office-not-found-msg").addClass("hide"),$(".ol_use_current_location").css("bottom","-40px")),"undefined"!=typeof switchToEntry&&switchToEntry(),$(".ol__entry, .entry, .tools__close, #ol-close").removeClass("hide"),$(".ol__entry-screen, .ol__entry-screen__restart, .ol__entry-screen h2").addClass("hide"),clearAll()}function closeEventHandler(){$(".ol_close").length&&($(".ol_close").on("click",function(){_scope&&_scope.toggleEntry()}),clearAll(),clearMessages())}function backToSearchEventHandler(){$(".ol__back").length&&($(".ol__back").on("click",function(){_scope&&_scope.toggleEntry()}),clearAll(),clearMessages())}function initialize(){null==autocomplete&&"object"==typeof google&&(autocomplete=new google.maps.places.Autocomplete(document.getElementById("ol-zip"),{types:["geocode"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){var place=autocomplete.getPlace();unrecognizedLocations=null,null==place.formatted_address?(new google.maps.Geocoder).geocode({address:place.name},function(results){unrecognizedLocations=results,unrecognizedLocations.length&&(place=unrecognizedLocations[0]),findLatLng(place)}):findLatLng(place)}))}function findLocation(address,callback){if("object"==typeof google){var place=null;(new google.maps.Geocoder).geocode({address:address},function(results){null!=results&&results.length>0&&(place=results[0]),findLatLng(place,callback)})}}function clearAll(){$("#ol-zip").val(""),$("#ol-zip").attr("title",""),$("#ol-zip").attr("aria-label",""),$("#app-ol .mdl-textfield").removeClass("is-dirty"),latitude=null,longitude=null}function findLatLng(place,callback){if(address=null,null!=place){address=place.formatted_address;var geometry=place.geometry;if(latitude=null,longitude=null,null!=geometry&&null!=geometry.location){var location=geometry.location;latitude=location.lat(),longitude=location.lng()}showMessages(),null!=address&&($("#ol-zip").val(address),$("#ol-zip").attr("title",address),$("#ol-zip").attr("aria-label",address)),callback&&callback()}else showMessages()}function clearMessages(){$(".ol__entry .ol-zip-msg").addClass("hide"),$(".ol__entry p.ol-location-msg").addClass("hide"),$(".ol__entry p.ol-office-not-found-msg").addClass("hide"),$(".ol__entry .office-search .mdl-textfield").removeClass("is-invalid"),$(".ol_use_current_location").css("bottom","-40px"),$(".entry .ol-zip-msg").addClass("hide"),$(".entry p.ol-location-msg").addClass("hide"),$(".entry p.ol-office-not-found-msg").addClass("hide"),$(".entry .office-search .mdl-textfield").removeClass("is-invalid")}function showMessages(){return clearMessages(),null==address||null==latitude||null==longitude?($(".ol__entry .ol-zip-msg").removeClass("hide"),$(".entry .ol-zip-msg").removeClass("hide"),$(".ol__entry .office-search .mdl-textfield").addClass("is-invalid"),$(".entry .office-search .mdl-textfield").addClass("is-invalid"),$("#ol-zip").focus(),void 0):void 0}function search(){return null==latitude||null==longitude?(showMessages(),void 0):(showSpinner(),setTimeout(function(){return latitude&&longitude?_scope?(_scope.setClientInfo(null),_scope.setType(olType),_scope.searchByLatLong(latitude,longitude),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(olType),_scope.searchByLatLong(latitude,longitude))}),void 0):void 0},10),void 0)}function geolocate(){$("#ol-zip").val(""),$("#ol-zip").attr("title",""),$("#ol-zip").attr("aria-label",""),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){position&&position.coords.latitude&&position.coords.longitude?(latitude=position.coords.latitude,longitude=position.coords.longitude,search()):($(".ol__entry p.ol-location-msg").removeClass("hide"),$(".ol__entry p.ol-location-msg").html("The current position could not be determined."),$(".entry p.ol-location-msg").removeClass("hide"),$(".entry p.ol-location-msg").html("The current position could not be determined."),removeSpinner())},function(error){var _geoMessage=error.message;$(".ol__entry p.ol-location-msg").removeClass("hide"),$(".ol__entry p.ol-location-msg").html(_geoMessage),$(".entry p.ol-location-msg").removeClass("hide"),$(".entry p.ol-location-msg").html(_geoMessage),removeSpinner()},__options):($(".ol__entry p.ol-location-msg").html("Geolocation is not supported by your browser."),$(".entry p.ol-location-msg").html("Geolocation is not supported by your browser."),removeSpinner())}var otherAPIs=["//maps.google.com/maps/api/js?v=3.5&libraries=places&client=gme-hrbtaxgroupinc1&sensor=false&channel=officelocator","/includes/app/ol-tool/js/ol.min.js","/includes/app/libs/js/colsmap.js"],__options={enableHighAccuracy:!0,timeout:3e4,maximumAge:0},__spinner=null;if(cachedUrls);else var cachedUrls=[];tpLoader=new AngularLoader,tpLoader.setScopeRequired(!0),tpLoader.setLoadModuleOnDemand(!0),tpLoader.useConsolidate(["/includes/app/speedy-tool/js/tpf-consolidated.min.js"]);var _scope=null,params=!1,address=getParameterByName("address"),latitude=getParameterByName("lat"),longitude=getParameterByName("lon");(address||latitude&&longitude)&&(tpLoader.setLoadModuleOnDemand(!1),params=!0);var ngModules=["ui.router","angularSpinner","validation","ngAria","validation.rule"];setTimeout(function(){tpLoader.loadAngularAPI(ngModules,otherAPIs,"ol-tool",["olApp"],function(){})},1e3),$(".ol_use_current_location").css("bottom","-40px"),$("#ol-zip").on("keypress",function(e){13==e.which&&e.preventDefault()}),$("#ol-zip").on("input",function(){latitude=null,longitude=null,address=null});var autocomplete=null,unrecognizedLocations=null;$("#tools .tools__close").on("click",function(){clearAll(),clearMessages()}),$("#ol-zip").focus(function(){initialize()}),$("#ol-search-btn").on("click",function(){clearMessages(),$("#ol-zip").val().length>0&&(null==latitude||null==longitude)?findLocation($("#ol-zip").val(),search):setTimeout(search,1)}),$("#ol-location-btn").on("click",function(){showSpinner(),clearMessages(),setTimeout(geolocate,1)})});