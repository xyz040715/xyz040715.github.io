$(document).ready(function(){function getParameterByName(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function showSpinner(custom){null==__spinner&&(__spinner=(new Spinner).spin()),__processing=!0,$(".tpf__entry").length>0?($(".tpf__entry").append(__spinner.el),$(".tpf__entry").addClass("blocker")):$(".entry").length>0?($(".entry").append(__spinner.el),$(".entry").addClass("blocker")):$(custom).length>0&&($(custom).append(__spinner.el),$(custom).addClass("blocker")),$("#ct-zip,#ct-search-btn ,.ct-location-btn,.seo-mk-app-btn,.seo-tp-mk-app-btn").prop("disabled",!0)}function removeSpinner(){__processing=!1,$("body .spinner").remove(),$("body").removeClass("blocker"),$(".tpf__entry .spinner, .entry .spinner").remove(),$(".tpf__entry, .entry").removeClass("blocker"),$("#ct-zip,#ct-search-btn ,.ct-location-btn,.seo-mk-app-btn,.seo-tp-mk-app-btn").prop("disabled",!1),$(".blocker").removeClass("blocker")}function _switchToApp(){$(".ct-office-not-found-msg").addClass("hide"),$("section #tpf-tool").css("display","block"),removeSpinner(),"undefined"!=typeof switchToApp&&switchToApp(),$(".tpf__entry, .entry, .tools__close, #tpf-close").addClass("hide"),$(".tpf__entry-screen, .tpf__entry-screen__restart, .tpf__entry-screen h2").removeClass("hide"),closeEventHandler(),backToSearchEventHandler()}function _switchToEntry(obj){removeSpinner(),obj&&0==obj.officeAvailable?($(".ct-office-not-found-msg").removeClass("hide"),$(".use_current_location").css("bottom","-70px")):($(".ct-office-not-found-msg").addClass("hide"),$(".use_current_location").css("bottom","-40px")),"undefined"!=typeof switchToEntry&&switchToEntry(),$(".tpf__entry, .entry, .tools__close, #tpf-close").removeClass("hide"),$(".tpf__entry-screen, .tpf__entry-screen__restart, .tpf__entry-screen h2").addClass("hide"),clearAll()}function closeEventHandler(){$(".ct_close").length&&($(".ct_close").on("click",function(){_scope&&_scope.toggleEntry()}),clearAll(),clearMessages()),$(".ct_sb_close").length&&$(".ct_sb_close").on("click",function(){$("#tpf-tool").css("display","none"),$(".entry").addClass("hide"),$(".tools__close").removeClass("hide"),$($("#smQuestionForm").find(".sm-fy20")[$("#smQuestionForm").find(".sm-fy20").length-1]).css("display","block")})}function backToSearchEventHandler(){$(".ct__back").length&&($(".ct__back").on("click",function(){_scope&&_scope.toggleEntry()}),clearAll(),clearMessages())}function _setProcessCompleted(obj){highlightUpcomingHours(obj.apptCalDate),__processing=!1,removeSpinner()}function highlightUpcomingHours(apptCalDate){var active=!1;$("ul.office-cal  li ul li a.date").each(function(){try{var calendarDate=$(this).data("calendarDate");calendarDate&&(calendarDate=new Date(calendarDate),!active&&$that&&$that.parent().removeClass("active"),apptCalDate.getTime()==calendarDate.getTime()&&($(this).parent().addClass("active"),$that=$(this),active=!0))}catch(e){console.log("highlightUpcomingHours : "+apptCalDate+" : "+calendarDate+" "+e)}})}function searchByTPP(){if(1!=__processing){var taxproInfo=_tppInfo;$that&&$that.parent().removeClass("active"),setTimeout(function(){return showSpinner("section.tp-profile-hero .container"),callAnalytics(),_scope?(_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(null),_scope.setFilterTaxProId(taxproInfo.taxpro),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByTp(taxproInfo),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(null),_scope.setFilterTaxProId(taxproInfo.taxpro),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByTp(taxproInfo))}),void 0)},10)}}function initialize(){null==autocomplete&&"object"==typeof google&&(autocomplete=new google.maps.places.Autocomplete(document.getElementById("ct-zip"),{types:["geocode"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){var place=autocomplete.getPlace();unrecognizedLocations=null,null==place.formatted_address?(new google.maps.Geocoder).geocode({address:place.name},function(results){unrecognizedLocations=results,unrecognizedLocations.length&&(place=unrecognizedLocations[0]),findLatLng(place)}):findLatLng(place)}))}function findLocation(address,callback){if("object"==typeof google){var place=null;(new google.maps.Geocoder).geocode({address:address},function(results){null!=results&&results.length>0&&(place=results[0]),findLatLng(place,callback)})}}function clearAll(){$("#ct-zip").val(""),$("#ct-zip").attr("title",""),$("#ct-zip").attr("aria-label",""),$("#app-tpf .mdl-textfield").removeClass("is-dirty"),latitude=null,longitude=null}function findLatLng(place,callback){if(address=null,null!=place){address=place.formatted_address;var geometry=place.geometry;if(latitude=null,longitude=null,null!=geometry&&null!=geometry.location){var location=geometry.location;latitude=location.lat(),longitude=location.lng()}showMessages(),null!=address&&($("#ct-zip").val(address),$("#ct-zip").attr("title",address),$("#ct-zip").attr("aria-label",address)),callback&&callback()}else showMessages()}function clearMessages(){$(".tpf__entry .ct-zip-msg").addClass("hide"),$(".tpf__entry p.ct-location-msg").addClass("hide"),$(".tpf__entry p.ct-office-not-found-msg").addClass("hide"),$(".tpf__entry .office-search .mdl-textfield").removeClass("is-invalid"),$(".use_current_location").css("bottom","-40px"),$(".entry .ct-zip-msg").addClass("hide"),$(".entry p.ct-location-msg").addClass("hide"),$(".entry p.ct-office-not-found-msg").addClass("hide"),$(".entry .office-search .mdl-textfield").removeClass("is-invalid")}function showMessages(){return clearMessages(),null==address||null==latitude||null==longitude?($(".tpf__entry .ct-zip-msg").removeClass("hide"),$(".entry .ct-zip-msg").removeClass("hide"),$(".tpf__entry .office-search .mdl-textfield").addClass("is-invalid"),$(".entry .office-search .mdl-textfield").addClass("is-invalid"),$("#ct-zip").focus(),void 0):void 0}function sb_search(){setTimeout(function(){if(answerValid){var questionnaires=sbQuestionResult;return _scope?(_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchBySB(questionnaires),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchBySB(questionnaires))}),void 0)}},10)}function search(){return null==latitude||null==longitude?(showMessages(),void 0):(showSpinner(),setTimeout(function(){return latitude&&longitude?(callAnalytics(),_scope?(_scope.setClientInfo(null),_scope.setType(tpfType),_scope.searchByLatLong(latitude,longitude),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.searchByLatLong(latitude,longitude))}),void 0)):void 0},10),void 0)}function geolocate(){$("#ct-zip").val(""),$("#ct-zip").attr("title",""),$("#ct-zip").attr("aria-label",""),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){position&&position.coords.latitude&&position.coords.longitude?(latitude=position.coords.latitude,longitude=position.coords.longitude,search()):($(".tpf__entry p.ct-location-msg").removeClass("hide"),$(".tpf__entry p.ct-location-msg").html("The current position could not be determined."),$(".entry p.ct-location-msg").removeClass("hide"),$(".entry p.ct-location-msg").html("The current position could not be determined."),removeSpinner())},function(error){var _geoMessage=error.message;$(".tpf__entry p.ct-location-msg").removeClass("hide"),$(".tpf__entry p.ct-location-msg").html(_geoMessage),$(".entry p.ct-location-msg").removeClass("hide"),$(".entry p.ct-location-msg").html(_geoMessage),removeSpinner()},__options):($(".tpf__entry p.ct-location-msg").html("Geolocation is not supported by your browser."),$(".entry p.ct-location-msg").html("Geolocation is not supported by your browser."),removeSpinner())}function callAnalytics(){try{HRBData.digital_data.appointment_type="","EAP"==tpfType?HRBData.digital_data.appointment_type="ea":"EAFF"==tpfType?HRBData.digital_data.appointment_type="ea":"IFL"==tpfType?HRBData.digital_data.appointment_type="ra":"1040ez"==tpfType&&(HRBData.digital_data.appointment_type="ez"),HRB.analytics.callRule("retail_appt_start")}catch(e){console.log("Error: HRB.analytics.callRule is failed : "+e)}}var otherAPIs=["/includes/app/speedy-tool/js/calendar.js","//maps.google.com/maps/api/js?v=3.5&libraries=places&client=gme-hrbtaxgroupinc1&sensor=false&channel=officelocator","/includes/app/speedy-tool/js/tpf.min.js","/includes/app/libs/js/colsmap.js"],__options={enableHighAccuracy:!0,timeout:3e4,maximumAge:0},__spinner=null,__processing=!1,tpLoader=new AngularLoader;tpLoader.setScopeRequired(!0),tpLoader.setLoadModuleOnDemand(!0),tpLoader.useConsolidate(["/includes/app/speedy-tool/js/tpf-consolidated.min.js"]);var _scope=null,params=!1,address=getParameterByName("address"),latitude=getParameterByName("lat"),longitude=getParameterByName("lon");(address||latitude&&longitude)&&(tpLoader.setLoadModuleOnDemand(!1),params=!0);var ngModules=["ui.router","angularSpinner","validation","ngAria","validation.rule"];tpLoader.loadAngularAPI(ngModules,otherAPIs,"tpf-tool",["tpfApp"],function(){address?($("#ct-zip").val(address),$("#ct-search-btn").trigger("click"),$(".ct-open-close").trigger("click")):latitude&&longitude&&($(".ct-location-btn").trigger("click"),$(".ct-open-close").trigger("click"))}),$(".use_current_location").css("bottom","-40px"),$("#ct-zip").on("keypress",function(e){13==e.which&&e.preventDefault()}),$("#ct-zip").on("input",function(){latitude=null,longitude=null,address=null}),$("#seo-mk-app-btn-one,#seo-mk-app-btn-two,.seo-mk-app-btn").on("dblclick",function(e){e.preventDefault(),e.stopPropagation()}),$("#seo-mk-app-btn-one,#seo-mk-app-btn-two").on("click",function(e){if(console.log(e),1!=__processing){__processing=!0;var address=$(this).data("zip"),officeId=$(this).data("office");$that&&$that.parent().removeClass("active"),setTimeout(function(){return showSpinner("section.office-listing .container"),showSpinner("section.hero .container"),callAnalytics(),_scope?(_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByZip(address),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByZip(address))}),void 0)},10)}});var $that=null;$("ul.office-cal  li ul li a.date").on("click",function(){if(0!=$("#seo-mk-app-btn-one").length){var date=$(this).data("date"),officeId=$(this).data("office"),address=$(this).data("address"),overlap=$(this).data("overlap");try{if(date){var mm=date.substr(0,date.indexOf("/")).trim(),dd=date.substr(date.indexOf("/")+1,date.length).trim(),yy=(new Date).getFullYear();overlap&&(yy+=1);var calendarDate=mm+"/"+dd+"/"+yy,toDate=new Date;if(toDate.setHours(0,0,0,0),isNaN(new Date(calendarDate))||toDate>new Date(calendarDate))return;$("#tpf-tool").length>0&&$("html,body").animate({scrollTop:$("#tpf-tool").position().top},200)}}catch(e){console.log(" Data error "+e)}1!=__processing&&(__processing=!0,$that&&$that.parent().removeClass("active"),$(this).parent().addClass("active"),$that=$(this),setTimeout(function(){return"none"==$("#tpf-tool").css("display")&&showSpinner("section.hero .container"),callAnalytics(),_scope?("none"==$("#tpf-tool").css("display")&&$("#tpf-tool").slideDown(200,function(){removeSpinner()}),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setWeekDate(calendarDate),_scope._setProcessCompleted(_setProcessCompleted),_scope.navigateToBack("office-details"),_scope.updateAppointments(),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setWeekDate(calendarDate),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByZip(address))}),void 0)},10))}}),$("ul.office-cal  li ul li a.date").each(function(){0==$("#seo-mk-app-btn-one").length&&($(this).css("opacity","0.6"),$(this).next().css("opacity","0.6"),$(this).css("cursor","text"),$(this).off("click"));try{var overlap=$(this).data("overlap"),date=$(this).data("date");$(this).data("office"),$(this).data("address");var overlap=$(this).data("overlap");if($(this).data("closed"),date){var mm=date.substr(0,date.indexOf("/")).trim(),dd=date.substr(date.indexOf("/")+1,date.length).trim(),yy=(new Date).getFullYear();overlap&&(yy+=1);var calendarDate=mm+"/"+dd+"/"+yy;$(this).data("calendarDate",calendarDate);var toDate=new Date;toDate.setHours(0,0,0,0),(isNaN(new Date(calendarDate))||toDate>new Date(calendarDate))&&($(this).css("opacity","0.6"),$(this).next().css("opacity","0.6"),$(this).css("cursor","text"),$(this).off("click"))}}catch(e){console.log(" Data error "+e)}}),$(".seo-tp-mk-app-btn").on("click",function(){searchByTPP()}),$(".seo-mk-app-btn").on("click",function(){if(null==getParameterByName("oid")&&void 0==$(this).data("office"))return searchByTPP(),void 0;var address=$(this).data("zip"),officeId=$(this).data("office"),taxproId=-1;"undefined"!=typeof _tppInfo&&(null==address&&null==officeId&&(address=parseInt(_tppInfo.oidZip),officeId=parseInt(_tppInfo.oid)),taxproId=parseInt(_tppInfo.taxpro),console.log("TPP "+address+" : "+officeId+" : "+taxproId)),$that&&$that.parent().removeClass("active"),setTimeout(function(){return showSpinner("section.hero .container"),callAnalytics(),_scope?(_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setFilterTaxProId(taxproId),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByZip(address),void 0):(tpLoader.loadModule(function(scope){scope&&(_scope=scope,_scope._setSwitchToApp(_switchToApp),_scope._setSwitchToEntry(_switchToEntry),_scope.setClientInfo(null),_scope.setType(tpfType),_scope.setFilterOfficeId(officeId),_scope.setFilterTaxProId(taxproId),_scope.setWeekDate(null),_scope._setProcessCompleted(_setProcessCompleted),_scope.searchByZip(address))}),void 0)},10)});var autocomplete=null,unrecognizedLocations=null;$("#tools .tools__close").on("click",function(){clearAll(),clearMessages()}),$("#ct-zip").focus(function(){initialize()}),$("#ct-search-btn").on("click",function(){clearMessages(),$("#ct-zip").val().length>0&&(null==latitude||null==longitude)?findLocation($("#ct-zip").val(),search):setTimeout(search,1)}),$("#get-cons-times,#get-cons-times1").on("click",function(){clearMessages(),setTimeout(sb_search,1)}),$("#ct-location-btn").on("click",function(){showSpinner(),clearMessages(),setTimeout(geolocate,1)})});